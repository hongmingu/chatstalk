<!DOCTYPE html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Demo</title>
    {% include 'others/header_static.html' %}
    {% include 'others/favicon.html' %}

    {% load static from staticfiles %}
    <script src="{% static 'js/navbar.js' %}"></script>
    <script src="{% static 'js/a_selected.js' %}"></script>
    <script src="{% static 'js/re_socket.js' %}"></script>
    <script src="{% static 'js/nav_badge.js' %}"></script>
    <script src="{% static 'js/date_differ.js' %}"></script>
    <script src="{% static 'js/home_populate.js' %}"></script>
    <script src="{% static 'js/modal_resize.js' %}"></script>

    <link href="https://fonts.googleapis.com/css?family=Tauri" rel="stylesheet">
    {% if user.is_authenticated %}
    {% else %}
    {% endif %}

    <style>
        .write_new_post{
            font-weight: bold; color: white; width: 100%
        }
        .home_feed_title{
            padding: 10px; font-weight: bold; font-size: 14px; white-space:pre-wrap; word-wrap: break-word; max-width: 100%;
        }
        .home_feed_desc{
            padding-right: 10px; padding-left:10px; padding-top:5px; padding-bottom:10px; font-size: 12px; white-space:pre-wrap; word-wrap: break-word; max-width: 100%;
        }
        .home_feed_chat_photo{
            font-weight: bold;
        }
        .home_feed_chat_start{

        }
        .home_feed_comment_delete {
            font-size: 12px;
        }
        .home_feed_comment_textarea {
            height: 30px!important;
            resize: none;
        }

        .home_feed_comment_textarea_send{
            height: 30px!important;
        }
        .home_feed_comment_wrapper{
            width: 100%!important;
        }
        .heart_black{
            font-size: 12px;
        }
        .home_feed_like_count{
            font-size: 12px;
        }
        .home_feed_comment_more{
            background-color: lightgray; font-size: 12px;
        }
        .home_feed_chat_new{
            border: #cd4a42 2px solid; border-radius: 3px
        }
        .home_feed_new_comment{
            background-color: lightgoldenrodyellow;
        }
        .modal_close{
            position: absolute; right: 10px; top: 10px;
        }
        .modal_dialog_reading_post{
            margin-top: 8px; margin-bottom: 8px;
        }
        .modal_top_padder{
            height: 35px;
        }
        .modal_reading_chat{
            overflow-y: auto; ;
        }
        .modal_reading_form{
            position: absolute; width: 95%
        }
        .modal_reading_form_input_wrapper{
            position: absolute; top:10px
        }
        .modal_reading_form_textarea{
            height: 50px!important; resize: none;
        }
        .modal_reading_from_textarea_button{
            height: 50px!important;
        }
        .modal_reading_form_inner_wrapper{
            width: 95%;
        }

        .reading_chat_img{
            min-width: 50px; display: inline-block; vertical-align: top
        }
        .reading_chat_content{
            display:inline-block; width: 60%
        }
        .reading_chat_text{
            background-color: orange; padding: 5px
        }
        .reading_like_wrapper{
            display: inline-block; vertical-align: bottom;
        }
        .reading_like{
            font-size: 12px;
        }
        .reading_like_text{
            font-size: 10px
        }
        .reading_chat_rest_text{
            background-color: lightgray; padding: 5px; font-size: 12px
        }
        .reading_chat_more_load{
            background-color: #1b6d85; color: white
        }
        .reading_chat_started{
            background-color: #1eda0f; color: white
        }
        .reading_chat_rest_messages{
            background-color: #39d842; color: white;padding:3px; border-radius: 3px; font-size: 12px
        }
        .reading_chat_interaction_white{
            background-color: #26ff07; color:white; height: 70px; padding-top: 20px
        }
        .reading_chat_interaction_green{
            color:#26ff07; height: 70px; padding-top: 20px
        }
        .interaction_play{
            font-size: 30px;
        }
        .reading_chat_img{
            max-width: 100%
        }

        .interaction_choice_update{
            height: 70px; float:left; display: inline-block; width: 50%; background-color: #39d842; font-size: 20px; padding:15px; color: white
        }


        .interaction_choice_interact{
            height: 70px; float:left; display: inline-block; width: 50%; font-size: 20px; padding:15px; color: #39d842
        }
        .reading_chat_rest_messages_delete{
            background-color: lightskyblue; padding: 2px; border-radius: 3px; font-size: 12px; color: white; margin-right: 55px;
        }
        .reading_chat_rest_time{
            font-size: 10px; background-color: #2e6da4; color: white; border-radius: 3px;
        }
    </style>


</head>
<body class="light_background_color height_100">
<!--navbar start-->
{% include 'baseapp/_navbar.html' %}

<!--navbar end-->
<!--page info-->
{% include 'others/bootstrap_tester.html' %}

<div class="hidden" id="page_kind" data-u="home"></div>
<div class="hidden" id="last_num" data-u=""></div>
<div class="hidden" id="post_last_id"></div>

<div class="hidden" id="clicked_post_id"></div>

<div class="hidden" id="reading_post_id"></div>
<div class="hidden" id="reading_post_profile_photo"></div>
<div class="hidden" id="reading_post_user_id"></div>
<div class="hidden" id="reading_post_profile_name"></div>
<div class="hidden" id="reading_post_chat_last_id"></div>
<div class="hidden" id="reading_post_chat_next_id"></div>
<div class="hidden" id="post_liking_next_id"></div>
<div class="hidden" id="post_chat_liking_next_id"></div>
<div class="hidden" id="post_chat_rest_liking_next_id"></div>
<div class="hidden" id="clicked_post_chat_id"></div>
<div class="hidden" id="clicked_post_chat_rest_id"></div>
{% if user.is_authenticated %}
    <div class="hidden" id="user_id" data-u="{{ user.username }}">{{ user.username }}</div>
{% endif %}
<!--page info end -->

<div class="container-fluid margin_top_50">
    <div class="row">
        <div class="col-xs-12 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4">
            <div class="row">
                <div align="center"><a href="{% url 'baseapp:create_new' %}"><div class="clickable padding_5 main_background_color write_new_post">Write New Post</div></a></div>
                <!--여기서 modal -->
                <div id="content"></div>
                <div class="hidden" align="center" id="home_feed_more_load"><a href="{% url 'baseapp:create_new' %}"><div class="clickable padding_5 main_background_color write_new_post">More Load</div></a></div>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_menu">
    <div class="modal-dialog modal-dialog_menu">
      <div class="modal-content modal-content_menu">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body modal-body_menu">
            <div class="row">
              <p class="h4" align="center"><a href="{% url 'authapp:settings' %}"><span class="clickable padding_5" style="background-color: #00aced">Settings</span></a></p>
            </div>
            <div class="row">
              <p class="h4" align="center"><a href="{% url 'authapp:log_out' %}"><span class="clickable padding_5" style="background-color: #00aced">Log out</span></a></p>
            </div>
        </div>
        <div class="modal-footer modal-footer_menu">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
</div>
<div class="modal fade" id="modal_feed_menu">
    <div class="modal-dialog modal-dialog_menu">
      <div class="modal-content modal-content_menu">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body modal-body_menu" id="modal_feed_menu_content">
            <div align="center">
                <input type="text" id="modal_feed_input" style="width: 80%">
            </div>
            <div align="center" style="margin-top: 10px">
              <a href=""><span class="clickable padding_5" id="modal_feed_copy" style="background-color: #85edb3; border-radius: 3px">copy link</span></a>
            </div>
            <div align="center" style="margin-top: 10px">
              <a href=""><span class="clickable padding_5" id="modal_feed_test" style="background-color: #85edb3; border-radius: 3px">copy link</span></a>
            </div>
        </div>
      </div>
    </div>
</div>

<div class="modal fade modal_second_membrane" id="modal_second" style="z-index: 1100;">
    <div class="modal-dialog modal-dialog_menu">
      <div class="modal-content modal-content_menu">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="" style="height: 400px; background-color: red">

        </div>
      </div>
    </div>
</div>
  <!-- Hidden 으로 데이터 저장해놓고 modal on show 랑 hide 에서 그 데이터 불러와서 모달 채우게 하자. 그리고 임플린은 친구 중심이고
  피드가 존재하게 되었기 때문에 팔로우가 부가적으로 존재하는 것 뿐이다. -->
  <div class="modal fade" id="modal_reading_post">
    <div class="modal-dialog modal_dialog_reading_post">
      <div class="modal-content" id="modal_reading_post_content">

        <div class="modal-body padding_0">

            <button type="button" class="close modal_close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <div class="modal_top_padder"></div>
            <div id="modal_reading_contents">
                <div class="modal_reading_chat">
                    <a href=""><div class="reading_chat_more_load clickable hidden" id="reading_chat_more_load" align="center">MORE LOAD</div></a>
                    <div class="reading_chat_started hidden" id="reading_chat_started" align="center">Convo started</div>
                    <div id="modal_reading_chat">


                    </div>


                </div>
                <div class="modal_reading_interaction" id="modal_reading_interaction" align="center">
                    <a href="">
                        <div class="clickable reading_chat_interaction_white hidden reading_chat_next reading_chat_play hidden" id="interaction_play_white">
                            <span class="glyphicon glyphicon-play interaction_play"></span>
                        </div>
                    </a>

                    <a href="">
                        <div class="clickable reading_chat_interaction_green reading_chat_next reading_chat_play hidden" id="interaction_play_green">
                            <span class="glyphicon glyphicon-play interaction_play"></span>
                        </div>
                    </a>

                    <a href="">
                        <div class="reading_chat_interaction_update reading_chat_next hidden" id="interaction_update">
                            <a href=""><div class="clickable interaction_choice_update" id="interaction_choice_update">update</div></a>
                            <a href=""><div class="clickable interaction_choice_interact" id="interaction_choice_interact">interact</div></a>
                        </div>
                    </a>
                    <div class="modal_reading_form_inner_wrapper reading_chat_next hidden" id="interaction_form">
                        <form class="modal_reading_form">
                        <div class="input-group input-group-sm modal_reading_form_input_wrapper">
                            <textarea class="form-control modal_reading_form_textarea" placeholder="message"></textarea>
                            <div class="input-group-btn">
                                <button class="btn btn-default modal_reading_from_textarea_button" type="submit"><i
                                        class="glyphicon glyphicon-send"></i></button>
                            </div>
                        </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
      </div>
    </div>
  </div>

<div class="modal fade" id="modal_post_liking">
    <div class="modal-dialog modal-dialog_menu">
      <div class="modal-content modal-content_menu">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body modal_follow_wrapper" id="modal_post_liking_wrapper">
            <div align="center">likes</div>
            <div id="modal_post_liking_list">

            </div>
            <a href=""><div class="hidden" align="center" id="modal_post_liking_more">more</div></a>
        </div>
      </div>
    </div>
</div>


<div class="modal fade" id="modal_post_chat_liking">
    <div class="modal-dialog modal-dialog_menu">
      <div class="modal-content modal-content_menu">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body modal_follow_wrapper" id="modal_post_chat_liking_wrapper">
            <div align="center">likes</div>
            <div id="modal_post_chat_liking_list">

            </div>
            <a href=""><div class="hidden" align="center" id="modal_post_chat_liking_more">more</div></a>
        </div>
      </div>
    </div>
</div>


<div class="modal fade" id="modal_post_chat_rest_liking">
    <div class="modal-dialog modal-dialog_menu">
      <div class="modal-content modal-content_menu">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body modal_follow_wrapper" id="modal_post_chat_rest_liking_wrapper">
            <div align="center">likes</div>
            <div id="modal_post_chat_rest_liking_list">

            </div>
            <a href=""><div class="hidden" align="center" id="modal_post_chat_rest_liking_more">more</div></a>
        </div>
      </div>
    </div>
</div>
</body>
<script>

$(function () {
    $("#modal_post_chat_rest_liking").on("shown.bs.modal", function () {
        var height = $(window).height();
        $('.modal_follow_wrapper').css('max-height', height-120);
        $(window).on('resize', function(){

            if($(window).height() != height){
                height = $(window).height();
                $('.modal_follow_wrapper').css('max-height', height-120);
            }
        });
            var post_chat_id = $('#clicked_post_chat_rest_id').html()

            $.ajax({url:'/re/post/chat/rest/like/list/', type:'post', dataType:'json', cache:false,
                data:{
                    post_chat_rest_id: post_chat_id,
                    next_id: $('#post_chat_rest_liking_next_id').html()
                },
                success:function (data) {
                console.log(data)
                    if (data.res === 1){
                        $.each(data.set, function (key, value) {
                            var appender = '<div class="profile_list_wrapper"><a href="/'+value.username+'/">\n' +
                                '<img class="img_small" src="'+value.photo+'">\n' +
                                '<span class="profile_list_username">'+value.username+'</span>\n' +
                                '</a></div>'
                            $('#modal_post_chat_rest_liking_list').append(appender)
                        })
                    }
                    if (data.next === null){
                        $('#post_chat_rest_liking_next_id').html('')
                        $('#modal_post_chat_rest_liking_more').addClass('hidden')
                    } else {
                        $('#post_chat_rest_liking_next_id').html(data.next)
                        $('#modal_post_chat_rest_liking_more').removeClass('hidden')
                    }

                }
            })
    }).on("hidden.bs.modal", function () {

            $('#modal_post_chat_rest_liking_list').empty()
            $('#post_chat_rest_liking_next_id').html('')
            $('#reading_post_chat_rest_id').html('')
    })


    $("#modal_post_chat_liking").on("shown.bs.modal", function () {
        var height = $(window).height();
        $('.modal_follow_wrapper').css('max-height', height-120);
        $(window).on('resize', function(){

            if($(window).height() != height){
                height = $(window).height();
                $('.modal_follow_wrapper').css('max-height', height-120);
            }
        });
            var post_chat_id = $('#clicked_post_chat_id').html()

            $.ajax({url:'/re/post/chat/like/list/', type:'post', dataType:'json', cache:false,
                data:{
                    post_chat_id: post_chat_id,
                    next_id: $('#post_chat_liking_next_id').html()
                },
                success:function (data) {
                console.log(data)
                    if (data.res === 1){
                        $.each(data.set, function (key, value) {
                            var appender = '<div class="profile_list_wrapper"><a href="/'+value.username+'/">\n' +
                                '<img class="img_small" src="'+value.photo+'">\n' +
                                '<span class="profile_list_username">'+value.username+'</span>\n' +
                                '</a></div>'
                            $('#modal_post_chat_liking_list').append(appender)
                        })
                    }
                    if (data.next === null){
                        $('#post_chat_liking_next_id').html('')
                        $('#modal_post_chat_liking_more').addClass('hidden')
                    } else {
                        $('#post_chat_liking_next_id').html(data.next)
                        $('#modal_post_chat_liking_more').removeClass('hidden')
                    }

                }
            })
    }).on("hidden.bs.modal", function () {

            $('#modal_post_chat_liking_list').empty()
            $('#post_chat_liking_next_id').html('')
            $('#reading_post_chat_id').html('')
    })


    $("#modal_post_liking").on("shown.bs.modal", function () {
    var height = $(window).height();
    $('.modal_follow_wrapper').css('max-height', height-120);
    $(window).on('resize', function(){

        if($(window).height() != height){
            height = $(window).height();
            $('.modal_follow_wrapper').css('max-height', height-120);
        }
    });
            var post_id = $('#reading_post_id').html()

            $.ajax({url:'/re/post/like/list/', type:'post', dataType:'json', cache:false,
                data:{
                    post_id: post_id,
                    next_id: $('#post_liking_next_id').html()
                },
                success:function (data) {
                console.log(data)
                    if (data.res === 1){
                        $.each(data.set, function (key, value) {
                            var appender = '<div class="profile_list_wrapper"><a href="/'+value.username+'/">\n' +
                                '<img class="img_small" src="'+value.photo+'">\n' +
                                '<span class="profile_list_username">'+value.username+'</span>\n' +
                                '</a></div>'
                            $('#modal_post_liking_list').append(appender)
                        })
                    }
                    if (data.next === null){
                        $('#post_liking_next_id').html('')
                        $('#modal_post_liking_more').addClass('hidden')
                    } else {
                        $('#post_liking_next_id').html(data.next)
                        $('#modal_post_liking_more').removeClass('hidden')
                    }

                }
            })
        }).on("hidden.bs.modal", function () {
            $('#modal_post_liking_list').empty()
            $('#post_liking_next_id').html('')
            $('#reading_post_id').html('')
        });

})

</script>
<script>
    $("#modal_feed_menu").on("shown.bs.modal", function () {
        var clicked_post = $('#clicked_post_id').html()
        var scheme = window.location.protocol == "https:" ? "https" : "http";
        var path = scheme + '://' + window.location.host + '/post/' + clicked_post;
        $('#modal_feed_input').val(path).select();
    }).on("hidden.bs.modal", function () {
        $('#clicked_post_id').html('')
        $('#modal_feed_input').val('')
    });

    $('#modal_feed_copy').click(function (e) {
        e.preventDefault()
        var clicked_post = $('#clicked_post_id').html()
        var scheme = window.location.protocol == "https:" ? "https" : "http";
        var path = scheme + '://' + window.location.host + '/post/' + clicked_post;
        $('#modal_feed_input').val(path).select();
        document.execCommand('Copy')
    })
    $('#modal_feed_test').click(function (e) {
        e.preventDefault()
        $('#modal_sample').modal('show')

    })
</script>
<script>
    $(function () {
        $.ajax({url:'/re/home/feed/', type:'post', dataType:'json', cache:false,
            data:{
                last_id: $('#post_last_id').html()
            },
            success:function (data) {
            $.each(data.set, function (key, value) {
                var string = value.id
                var appender = '<div class="row div_base" id="post_div_'+value.id+'" data-u="'+value.id+'">' +
                    '<script defer>' +
                    '    home_populate("'+value.id+'")' +
                    '<'+'/script></div>'

                    //'console.log($("#post_div_'+value.id+'").attr("data-u"))' +
                $('#content').append(appender)
            })
                if (data.next === null){
                    $('#home_feed_more_load').addClass('hidden')
                } else {
                    $('#home_feed_more_load').removeClass('hidden')
                }

            }
        })
    })
</script>

<script>

    $("#modal_reading_post").on("shown.bs.modal", function () {

        var height = $(window).height();
        $('#modal_reading_post_content').css('height', height-16);
        $('#modal_reading_chat').css('height', height-16-70-35-20)

        var reading_post_id = $('#reading_post_id').html()
        var reading_post_profile_photo = $('#reading_post_profile_photo').html()
        var reading_post_profile_name = $('#reading_post_profile_name').html()
        $.ajax({url:'/re/post/already/read/', type:'post', dataType:'json', cache:false,
            data:{
                post_id:reading_post_id,
            },
            success:function (data) {
                if (data.res === 1) {
                var start = false
                    $.each(data.set, function (key, value) {
                        if (key === 0){
                            $('#reading_post_chat_last_id').html(value.id)
                        }
                        var prepender;

                        var align, profile_photo, chat_content, like, like_count, rest_messages;
                        switch (value.kind) {
                            case 'start':
                                start = true
                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            }

                            prepender = $(rest_messages)
                                break;
                            case 'text':
                                if (value.you_say === true){
                                    align = 'left';
                                    like_count = value.like_count
                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)

                                        like_count = like_count + 'k'
                                    }
                                    profile_photo = '<div class="reading_chat_img">\n' +
                                        '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                        '<div class="reading_chat_text">'+value.content+'</div>' +
                                        '</div>'

                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><a href=""><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span></a>' +
                                        '</div>'

                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                                '</div>\n')

                                } else if(value.you_say === false){
                                    align = 'right';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_text">'+value.content+'</div>' +
                                        '</div>'
                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                        '</div>'


                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                                '</div>\n')

                                }

                                break;

                            case 'photo':

                                if (value.you_say === true){

                                    align = 'left';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    profile_photo = '<div class="reading_chat_img">\n' +
                                        '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                        '<div><img class="reading_chat_img" src="'+value.content+'"></div>'+
                                        '</div>'
                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                        '</div>'

                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                                '</div>\n')
                                } else if(value.you_say === false) {

                                    align = 'right';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div><img class="reading_chat_img" src="'+value.content+'"></div>' +
                                        '</div>'
                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                        '</div>'

                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                                '</div>\n')

                                }

                                break;
                            default:
                                break;
                        }

                        prepender.find('#reading_like_count_'+value.id).on('click', function (e) {
                            e.preventDefault()
                            $('#clicked_post_chat_id').html(value.id)
                            $('#modal_post_chat_liking').modal('show')
                        });

                        prepender.find('.reading_like').on('click', function (e) {

                            e.preventDefault()
                            var post_chat_id = $(this).attr('data-u')

                            $.ajax({
                                url: '/re/post/chat/like/', type: 'post', dataType: 'json', cache: false,
                                data: {
                                    post_chat_id: post_chat_id,
                                },
                                success: function (data) {
                                    if (data.res === 1){
                                        var has_k = $('#reading_like_count_'+post_chat_id).html()

                                        if (data.liked === true){
                                          if (!(has_k.includes('k'))){
                                            $('#reading_like_count_'+post_chat_id).html(parseInt(has_k)+1)
                                          }
                                          $('#reading_like_span_'+post_chat_id).removeClass('glyphicon-heart-empty')
                                          $('#reading_like_span_'+post_chat_id).addClass('glyphicon-heart')
                                        }   else {
                                          if (!(has_k.includes('k'))){
                                            $('#reading_like_count_'+post_chat_id).html(parseInt(has_k)-1)
                                          }
                                          $('#reading_like_span_'+post_chat_id).removeClass('glyphicon-heart')
                                          $('#reading_like_span_'+post_chat_id).addClass('glyphicon-heart-empty')
                                        }
                                    }
                                }
                            })

                        });
                        prepender.find('.reading_chat_rest_messages').on('click', function (e) {
                            e.preventDefault()
                            var post_chat_id = $(this).attr('data-u')
                            $.ajax({
                              url: '/re/post/chat/rest/more/load/', type: 'post', dataType: 'json', cache: false,
                                data: {
                                    last_id: $('#rest_last_'+post_chat_id).html(),
                                    post_chat_id: post_chat_id,
                                },
                                success: function (data) {
                                  if (!($('#rest_start_'+post_chat_id).hasClass('hidden'))){
                                      $('#rest_start_'+post_chat_id).addClass('hidden')
                                  }

                                  if (data.rest_next === true){
                                      $('#rest_more_'+post_chat_id).removeClass('hidden')
                                  } else {
                                      $('#rest_more_'+post_chat_id).addClass('hidden')
                                  }

                                  $.each(data.set, function (key, value) {
                                        var like_count = value.like_count

                                        if (1000 <= value.like_count){
                                            like_count = parseInt(value.like_count / 1000)
                                            like_count = like_count + 'k'
                                        }
                                        var like = ''
                                        if (value.you_like === true){
                                            like = 'glyphicon-heart'
                                        } else {
                                            like = 'glyphicon-heart-empty'
                                        }
                                        var delete_div = ''
                                        if(value.user_id === $('#user_id').html() || $('#user_id').html() ===$('#reading_post_user_id').html()){
                                            delete_div = '<div align="right"><a href=""><span class="reading_chat_rest_messages_delete">delete</span></a></div>'
                                        }
                                        var pre_rest_appender = '<div class="reading_chat_rest" align="right" id="reading_chat_rest_wrapper_'+value.id+'">' +
                                            '<div class="reading_like_wrapper">' +
                                            '<a href=""><span id="rest_like_span_'+value.id+'"class="glyphicon '+like+' reading_like"></span></a><span class="reading_like_text"> </span><a href=""><span class="reading_like_text" id="rest_like_'+value.id+'" data-u="'+value.like_count+'">'+like_count+'</span></a>' +
                                            '</div>' +
                                            '<div class="reading_chat_content">' +
                                            '<div class="reading_chat_rest_name"><a href="/'+value.username+'/"><span>'+value.name+'</span></a></div>\n' +
                                            '<div class="reading_chat_rest_text">'+value.text+'<span>   </span><span class="reading_chat_rest_time">'+date_differ(value.created)+'</span></div>\n' +
                                            '</div>' +
                                            '<div class="reading_chat_img">' +
                                            '<img class="img_small" src="'+ value.photo +'">' +
                                            '</div>' + delete_div +
                                            '</div>'
                                        var rest_appender = $(pre_rest_appender)
                                      rest_appender.find('#rest_like_'+value.id).on('click', function (e) {
                                          e.preventDefault()
                                          $('#clicked_post_chat_rest_id').html(value.id)
                                          $('#modal_post_chat_rest_liking').modal('show')
                                      })
                                        rest_appender.find('.reading_like').on('click', function (e) {
                                            e.preventDefault()
                                            $.ajax({
                                              url: '/re/post/chat/rest/like/', type: 'post', dataType: 'json', cache: false,
                                                data: {
                                                    rest_id: value.id,
                                                },
                                                success: function (data) {
                                                  if (data.res === 1){
                                                      var has_k = $('#rest_like_'+value.id).html()

                                                    if (data.liked === true){
                                                      if (!(has_k.includes('k'))){
                                                        $('#rest_like_'+value.id).html(parseInt(has_k)+1)
                                                      }
                                                      $('#rest_like_span_'+value.id).removeClass('glyphicon-heart-empty')
                                                      $('#rest_like_span_'+value.id).addClass('glyphicon-heart')
                                                    }   else {
                                                      if (!(has_k.includes('k'))){
                                                        $('#rest_like_'+value.id).html(parseInt(has_k)-1)
                                                      }
                                                      $('#rest_like_span_'+value.id).removeClass('glyphicon-heart')
                                                      $('#rest_like_span_'+value.id).addClass('glyphicon-heart-empty')
                                                    }
                                                  }
                                                }
                                            })
                                        })
                                      rest_appender.find('.reading_chat_rest_messages_delete').on('click', function (e) {
                                          e.preventDefault()
                                          $.ajax({
                                              url: '/re/post/chat/rest/delete/', type: 'post', dataType: 'json', cache: false,
                                                data: {
                                                    rest_id: value.id,
                                                },
                                                success: function (data) {
                                                  if (data.res === 1){
                                                      if (data.deleted === true){
                                                          $('#reading_chat_rest_wrapper_'+value.id).replaceWith('<div align="right">removed</div>')
                                                      }
                                                  }
                                                }
                                            })
                                      })

                                        $('#rest_wrapper_' + post_chat_id).append(rest_appender)
                                      $('#rest_last_'+post_chat_id).html(value.id)
                                  })
                                }
                            })


                        })

                        $('#modal_reading_chat').prepend(prepender)

                    })



                    if (data.next === null){
                        if ($('#reading_post_user_id').html()===$('#user_id').html()){
                            $('.reading_chat_next').addClass('hidden')
                            $('#interaction_update').removeClass('hidden')
                        } else {
                            $('.reading_chat_next').addClass('hidden')
                            $('#interaction_form').removeClass('hidden')
                        }
                    } else {

                        $('#reading_post_chat_next_id').html(data.next.content.id)
                        if (data.next.content.you_say === true){
                            $('.reading_chat_next').addClass('hidden')
                            $('#interaction_play_white').removeClass('hidden')
                        } else if (data.next.content.you_say === false){
                            $('.reading_chat_next').addClass('hidden')
                            $('#interaction_play_green').removeClass('hidden')
                        }

                    }

if (start === false){
                        $('#reading_chat_more_load').removeClass('hidden')
                        $('#reading_chat_started').addClass('hidden')
                    } else {
                        $('#reading_chat_more_load').addClass('hidden')
                        $('#reading_chat_started').removeClass('hidden')
                    }

                }
            }
        })

    }).on("hidden.bs.modal", function () {
        var post_id = $('#reading_post_id').html()

        var appender = '<div class="row div_base" id="post_div_'+post_id+'" data-u="'+post_id+'">' +
            '<script defer>' +
            '    home_populate("'+post_id+'")' +
            '<'+'/script></div>'

        //'console.log($("#post_div_'+value.id+'").attr("data-u"))' +
        $('#post_div_'+post_id).replaceWith(appender)
        $('#modal_reading_chat').empty()
    });
    $('#reading_chat_more_load').click(function (e) {
        e.preventDefault()
        var reading_post_id = $('#reading_post_id').html()
        var reading_post_profile_photo = $('#reading_post_profile_photo').html()
        var reading_post_profile_name = $('#reading_post_profile_name').html()
        $.ajax({url:'/re/post/reading/more/load/', type:'post', dataType:'json', cache:false,
            data:{
                post_chat_last_id:$('#reading_post_chat_last_id').html(),
                post_id:$('#reading_post_id').html()
            },
            success:function (data) {
//------------------------------------------------------------------------------
                //-------------------------------------------------------------------------

                if (data.res === 1) {
                var start = false
                    $.each(data.set, function (key, value) {
                        var prepender;

                        var align, profile_photo, chat_content, like, like_count, rest_messages;
                        switch (value.kind) {
                            case 'start':
                                start = true
                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            }

                            prepender = $(rest_messages)
                                break;
                            case 'text':
                                if (value.you_say === true){
                                    align = 'left';
                                    like_count = value.like_count
                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)

                                        like_count = like_count + 'k'
                                    }
                                    profile_photo = '<div class="reading_chat_img">\n' +
                                        '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                        '<div class="reading_chat_text">'+value.content+'</div>' +
                                        '</div>'

                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                        '</div>'

                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                                '</div>\n')

                                } else if(value.you_say === false){
                                    align = 'right';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_text">'+value.content+'</div>' +
                                        '</div>'
                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                        '</div>'


                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                                '</div>\n')

                                }

                                break;

                            case 'photo':

                                if (value.you_say === true){

                                    align = 'left';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    profile_photo = '<div class="reading_chat_img">\n' +
                                        '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                        '<div><img class="reading_chat_img" src="'+value.content+'"></div>'+
                                        '</div>'
                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                        '</div>'

                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                                '</div>\n')
                                } else if(value.you_say === false) {

                                    align = 'right';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div><img class="reading_chat_img" src="'+value.content+'"></div>' +
                                        '</div>'
                                    // 작업중인부분 ------------------------------------
                                    var heart;
                                    if (value.you_like === true){
                                        heart = 'glyphicon-heart'
                                    } else {
                                        heart = 'glyphicon-heart-empty'
                                    }
                                    like = '<div class="reading_like_wrapper">' +
                                        '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                        '</div>'

                                    // 작업중인 부분------------------------------------------------------------
                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                                '</div>\n')

                                }

                                break;
                            default:
                                break;
                        }
                        prepender.find('.reading_like').on('click', function (e) {

                            e.preventDefault()
                            var post_chat_id = $(this).attr('data-u')

                            $.ajax({
                                url: '/re/post/chat/like/', type: 'post', dataType: 'json', cache: false,
                                data: {
                                    post_chat_id: post_chat_id,
                                },
                                success: function (data) {
                                    if (data.res === 1){
                                        var has_k = $('#reading_like_count_'+post_chat_id).html()

                                        if (data.liked === true){
                                          if (!(has_k.includes('k'))){
                                            $('#reading_like_count_'+post_chat_id).html(parseInt(has_k)+1)
                                          }
                                          $('#reading_like_span_'+post_chat_id).removeClass('glyphicon-heart-empty')
                                          $('#reading_like_span_'+post_chat_id).addClass('glyphicon-heart')
                                        }   else {
                                          if (!(has_k.includes('k'))){
                                            $('#reading_like_count_'+post_chat_id).html(parseInt(has_k)-1)
                                          }
                                          $('#reading_like_span_'+post_chat_id).removeClass('glyphicon-heart')
                                          $('#reading_like_span_'+post_chat_id).addClass('glyphicon-heart-empty')
                                        }
                                    }
                                }
                            })

                        });
                        prepender.find('.reading_chat_rest_messages').on('click', function (e) {
                            e.preventDefault()
                            var post_chat_id = $(this).attr('data-u')
                            $.ajax({
                              url: '/re/post/chat/rest/more/load/', type: 'post', dataType: 'json', cache: false,
                                data: {
                                    last_id: $('#rest_last_'+post_chat_id).html(),
                                    post_chat_id: post_chat_id,
                                },
                                success: function (data) {
                                  if (!($('#rest_start_'+post_chat_id).hasClass('hidden'))){
                                      $('#rest_start_'+post_chat_id).addClass('hidden')
                                  }

                                  if (data.rest_next === true){
                                      $('#rest_more_'+post_chat_id).removeClass('hidden')
                                  } else {
                                      $('#rest_more_'+post_chat_id).addClass('hidden')
                                  }

                                  $.each(data.set, function (key, value) {
                                        var like_count = value.like_count

                                        if (1000 <= value.like_count){
                                            like_count = parseInt(value.like_count / 1000)
                                            like_count = like_count + 'k'
                                        }
                                        var like = ''
                                        if (value.you_like === true){
                                            like = 'glyphicon-heart'
                                        } else {
                                            like = 'glyphicon-heart-empty'
                                        }
                                        var delete_div = ''
                                        if(value.user_id === $('#user_id').html() || $('#user_id').html() ===$('#reading_post_user_id').html()){
                                            delete_div = '<div align="right"><a href=""><span class="reading_chat_rest_messages_delete">delete</span></a></div>'
                                        }
                                        var pre_rest_appender = '<div class="reading_chat_rest" align="right" id="reading_chat_rest_wrapper_'+value.id+'">' +
                                            '<div class="reading_like_wrapper">' +
                                            '<a href=""><span id="rest_like_span_'+value.id+'"class="glyphicon '+like+' reading_like"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="rest_like_'+value.id+'" data-u="'+value.like_count+'">'+like_count+'</span>' +
                                            '</div>' +
                                            '<div class="reading_chat_content">' +
                                            '<div class="reading_chat_rest_name"><a href="/'+value.username+'/"><span>'+value.name+'</span></a></div>\n' +
                                            '<div class="reading_chat_rest_text">'+value.text+'<span>   </span><span class="reading_chat_rest_time">'+date_differ(value.created)+'</span></div>\n' +
                                            '</div>' +
                                            '<div class="reading_chat_img">' +
                                            '<img class="img_small" src="'+ value.photo +'">' +
                                            '</div>' + delete_div +
                                            '</div>'
                                        var rest_appender = $(pre_rest_appender)
                                        rest_appender.find('.reading_like').on('click', function (e) {
                                            e.preventDefault()
                                            $.ajax({
                                              url: '/re/post/chat/rest/like/', type: 'post', dataType: 'json', cache: false,
                                                data: {
                                                    rest_id: value.id,
                                                },
                                                success: function (data) {
                                                  if (data.res === 1){
                                                      var has_k = $('#rest_like_'+value.id).html()

                                                    if (data.liked === true){
                                                      if (!(has_k.includes('k'))){
                                                        $('#rest_like_'+value.id).html(parseInt(has_k)+1)
                                                      }
                                                      $('#rest_like_span_'+value.id).removeClass('glyphicon-heart-empty')
                                                      $('#rest_like_span_'+value.id).addClass('glyphicon-heart')
                                                    }   else {
                                                      if (!(has_k.includes('k'))){
                                                        $('#rest_like_'+value.id).html(parseInt(has_k)-1)
                                                      }
                                                      $('#rest_like_span_'+value.id).removeClass('glyphicon-heart')
                                                      $('#rest_like_span_'+value.id).addClass('glyphicon-heart-empty')
                                                    }
                                                  }
                                                }
                                            })
                                        })
                                      rest_appender.find('.reading_chat_rest_messages_delete').on('click', function (e) {
                                          e.preventDefault()
                                          $.ajax({
                                              url: '/re/post/chat/rest/delete/', type: 'post', dataType: 'json', cache: false,
                                                data: {
                                                    rest_id: value.id,
                                                },
                                                success: function (data) {
                                                  if (data.res === 1){
                                                      if (data.deleted === true){
                                                          $('#reading_chat_rest_wrapper_'+value.id).replaceWith('<div align="right">removed</div>')
                                                      }
                                                  }
                                                }
                                            })
                                      })

                                        $('#rest_wrapper_' + post_chat_id).append(rest_appender)
                                      $('#rest_last_'+post_chat_id).html(value.id)
                                  })
                                }
                            })


                        })

                        $('#modal_reading_chat').prepend(prepender)

                    })



                    if (start === false){
                        $('#reading_chat_more_load').removeClass('hidden')
                        $('#reading_chat_started').addClass('hidden')
                    } else {
                        $('#reading_chat_more_load').addClass('hidden')
                        $('#reading_chat_started').removeClass('hidden')
                    }
                }

            }
        })
    })
    $('#interaction_choice_interact').click(function (e) {
        e.preventDefault()
        $('.reading_chat_next').addClass('hidden')
        $('#interaction_form').removeClass('hidden')
    })
    $('#interaction_choice_update').click(function (e) {
        e.preventDefault()
        var scheme = window.location.protocol == "https:" ? "https" : "http";
        var path = scheme + '://' + window.location.host + "/post/update/";
        location.href= path + $('#reading_post_id').html()
    })
    $('.reading_chat_play').click(function (e) {
        e.preventDefault()


        var reading_post_id = $('#reading_post_id').html()
        var reading_post_profile_photo = $('#reading_post_profile_photo').html()
        var reading_post_profile_name = $('#reading_post_profile_name').html()
        $.ajax({url:'/re/post/chat/next/load/', type:'post', dataType:'json', cache:false,
            data:{
                post_chat_next_id:$('#reading_post_chat_next_id').html(),
            },
            success:function (data) {
            var prepender, align, profile_photo, chat_content, like, like_count, rest_messages;
            var start = false
            var last_id;
            $.each(data.set, function (key, value) {
                $('#reading_post_chat_last_id').html(value.id)
                switch (value.kind) {
                    case 'start':
                        start = true
                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            }

                            prepender = $(rest_messages)
                        break;
                    case 'text':
                        if (value.you_say === true){
                            align = 'left';
                            like_count = value.like_count
                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)

                                like_count = like_count + 'k'
                            }
                            profile_photo = '<div class="reading_chat_img">\n' +
                                '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                            chat_content = '<div class="reading_chat_content">' +
                                '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                '<div class="reading_chat_text">'+value.content+'</div>' +
                                '</div>'
                            // 작업중인부분 ------------------------------------
                            var heart;
                            if (value.you_like === true){
                                heart = 'glyphicon-heart'
                            } else {
                                heart = 'glyphicon-heart-empty'
                            }
                            like = '<div class="reading_like_wrapper">' +
                                '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                '</div>'


                            // 작업중인 부분------------------------------------------------------------
                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            }


                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                        '</div>\n')

                        } else if(value.you_say === false){
                            align = 'right';
                            like_count = value.like_count

                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)
                                like_count = like_count + 'k'
                            }
                            chat_content = '<div class="reading_chat_content">' +
                                '<div class="reading_chat_text">'+value.content+'</div>' +
                                '</div>'
                            // 작업중인부분 ------------------------------------
                            var heart;
                            if (value.you_like === true){
                                heart = 'glyphicon-heart'
                            } else {
                                heart = 'glyphicon-heart-empty'
                            }
                            like = '<div class="reading_like_wrapper">' +
                                '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                '</div>'

                            // 작업중인 부분------------------------------------------------------------
                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            }
                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                        '</div>\n')

                        }

                        break;

                    case 'photo':

                        if (value.you_say === true){

                            align = 'left';
                            like_count = value.like_count

                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)
                                like_count = like_count + 'k'
                            }
                            profile_photo = '<div class="reading_chat_img">\n' +
                                '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                            chat_content = '<div class="reading_chat_content">' +
                                '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                '<div><img class="reading_chat_img" src="'+value.content+'"></div>'+
                                '</div>'
                            // 작업중인부분 ------------------------------------
                            var heart;
                            if (value.you_like === true){
                                heart = 'glyphicon-heart'
                            } else {
                                heart = 'glyphicon-heart-empty'
                            }
                            like = '<div class="reading_like_wrapper">' +
                                '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                '</div>'

                            // 작업중인 부분------------------------------------------------------------
                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            }

                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                        '</div>\n')
                        } else if(value.you_say === false) {

                            align = 'right';
                            like_count = value.like_count

                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)
                                like_count = like_count + 'k'
                            }
                            chat_content = '<div class="reading_chat_content">' +
                                '<div><img class="reading_chat_img" src="'+value.content+'"></div>' +
                                '</div>'
                            // 작업중인부분 ------------------------------------
                            var heart;
                            if (value.you_like === true){
                                heart = 'glyphicon-heart'
                            } else {
                                heart = 'glyphicon-heart-empty'
                            }
                            like = '<div class="reading_like_wrapper">' +
                                '<a href=""><span class="glyphicon '+ heart +' reading_like" id="reading_like_span_'+value.id+'" data-u="'+value.id+'"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="reading_like_count_'+value.id+'">'+like_count+'</span>' +
                                '</div>'

                            // 작업중인 부분------------------------------------------------------------
                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div id="rest_wrapper_'+value.id+'" align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+value.rest_count+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div id="rest_wrapper_'+value.id+'"align="right"><a href=""><span class="glyphicon glyphicon-comment reading_chat_rest_messages clickable" id="rest_start_'+value.id+'" data-u="'+value.id+'">'+parseInt(value.like_count / 1000)+'k'+'</span></a></div><a href=""><div id="rest_more_'+value.id+'" class="rest_more_load reading_chat_rest_messages hidden" data-u="'+value.id+'" align="center">more</div></a><div class="hidden" id="rest_last_'+value.id+'"></div>'
                            }

                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                        '</div>\n')

                        }

                        break;
                    default:
                        break;

                }
                prepender.find('.reading_like').on('click', function (e) {

                            e.preventDefault()
                            var post_chat_id = $(this).attr('data-u')

                            $.ajax({
                                url: '/re/post/chat/like/', type: 'post', dataType: 'json', cache: false,
                                data: {
                                    post_chat_id: post_chat_id,
                                },
                                success: function (data) {
                                    if (data.res === 1){
                                        var has_k = $('#reading_like_count_'+post_chat_id).html()

                                        if (data.liked === true){
                                          if (!(has_k.includes('k'))){
                                            $('#reading_like_count_'+post_chat_id).html(parseInt(has_k)+1)
                                          }
                                          $('#reading_like_span_'+post_chat_id).removeClass('glyphicon-heart-empty')
                                          $('#reading_like_span_'+post_chat_id).addClass('glyphicon-heart')
                                        }   else {
                                          if (!(has_k.includes('k'))){
                                            $('#reading_like_count_'+post_chat_id).html(parseInt(has_k)-1)
                                          }
                                          $('#reading_like_span_'+post_chat_id).removeClass('glyphicon-heart')
                                          $('#reading_like_span_'+post_chat_id).addClass('glyphicon-heart-empty')
                                        }
                                    }
                                }
                            })

                        });

                prepender.find('.reading_chat_rest_messages').on('click', function (e) {
                    e.preventDefault()
                    var post_chat_id = $(this).attr('data-u')
                    $.ajax({
                      url: '/re/post/chat/rest/more/load/', type: 'post', dataType: 'json', cache: false,
                        data: {
                            last_id: $('#rest_last_'+post_chat_id).html(),
                            post_chat_id: post_chat_id,
                        },
                        success: function (data) {
                          console.log(data)
                          if (!($('#rest_start_'+post_chat_id).hasClass('hidden'))){
                              $('#rest_start_'+post_chat_id).addClass('hidden')
                          }

                          if (data.rest_next === true){
                              $('#rest_more_'+post_chat_id).removeClass('hidden')
                          } else {
                              $('#rest_more_'+post_chat_id).addClass('hidden')
                          }
                          
                          $.each(data.set, function (key, value) {
                                var like_count = value.like_count

                                if (1000 <= value.like_count){
                                    like_count = parseInt(value.like_count / 1000)
                                    like_count = like_count + 'k'
                                }
                                var like = ''
                                if (value.you_like === true){
                                    like = 'glyphicon-heart'
                                } else {
                                    like = 'glyphicon-heart-empty'
                                }
                                var delete_div = ''
                                if(value.user_id === $('#user_id').html() || $('#user_id').html()===$('#reading_post_user_id').html()){
                                    delete_div = '<div align="right"><a href=""><span class="reading_chat_rest_messages_delete">delete</span></a></div>'
                                }
                                var pre_rest_appender = '<div class="reading_chat_rest" align="right" id="reading_chat_rest_wrapper_'+value.id+'">' +
                                    '<div class="reading_like_wrapper">' +
                                    '<a href=""><span id="rest_like_span_'+value.id+'"class="glyphicon '+like+' reading_like"></span></a><span class="reading_like_text"> </span><span class="reading_like_text" id="rest_like_'+value.id+'" data-u="'+value.like_count+'">'+like_count+'</span>' +
                                    '</div>' +
                                    '<div class="reading_chat_content">' +
                                    '<div class="reading_chat_rest_name">'+value.name+'</div>\n' +
                                    '<div class="reading_chat_rest_text">'+value.text+'<span>   </span><span class="reading_chat_rest_time">'+date_differ(value.created)+'</span></div>\n' +
                                    '</div>' +
                                    '<div class="reading_chat_img">' +
                                    '<img class="img_small" src="'+ value.photo +'">' +
                                    '</div>' + delete_div +
                                    '</div>'
                                var rest_appender = $(pre_rest_appender)
                                rest_appender.find('.reading_like').on('click', function (e) {
                                    e.preventDefault()
                                    $.ajax({
                                      url: '/re/post/chat/rest/like/', type: 'post', dataType: 'json', cache: false,
                                        data: {
                                            rest_id: value.id,
                                        },
                                        success: function (data) {
                                          if (data.res === 1){
                                              var has_k = $('#rest_like_'+value.id).html()

                                            if (data.liked === true){
                                              if (!(has_k.includes('k'))){
                                                $('#rest_like_'+value.id).html(parseInt(has_k)+1)
                                              }
                                              $('#rest_like_span_'+value.id).removeClass('glyphicon-heart-empty')
                                              $('#rest_like_span_'+value.id).addClass('glyphicon-heart')
                                            }   else {
                                              if (!(has_k.includes('k'))){
                                                $('#rest_like_'+value.id).html(parseInt(has_k)-1)
                                              }
                                              $('#rest_like_span_'+value.id).removeClass('glyphicon-heart')
                                              $('#rest_like_span_'+value.id).addClass('glyphicon-heart-empty')
                                            }
                                          }
                                        }
                                    })
                                })
                              rest_appender.find('.reading_chat_rest_messages_delete').on('click', function (e) {
                                  e.preventDefault()
                                  $.ajax({
                                      url: '/re/post/chat/rest/delete/', type: 'post', dataType: 'json', cache: false,
                                        data: {
                                            rest_id: value.id,
                                        },
                                        success: function (data) {
                                          if (data.res === 1){
                                              if (data.deleted === true){
                                                  $('#reading_chat_rest_wrapper_'+value.id).replaceWith('<div align="right">removed</div>')
                                              }
                                          }
                                        }
                                    })
                              })

                                $('#rest_wrapper_' + post_chat_id).append(rest_appender)
                              $('#rest_last_'+post_chat_id).html(value.id)
                          })
                        }
                    })


                })
                $('#modal_reading_chat').append(prepender)

            })
                if (data.next === null){
                    if ($('#reading_post_user_id').html()===$('#user_id').html()){

                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_update').removeClass('hidden')
                    } else {
                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_form').removeClass('hidden')
                    }
                } else {
                    $('#reading_post_chat_next_id').html(data.next.content.id)
                    if (data.next.content.you_say === true){
                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_play_white').removeClass('hidden')
                    } else if (data.next.content.you_say === false){
                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_play_green').removeClass('hidden')
                    }
                //다른사람 글 볼때 딜리트 활성화 제거 .
                }
            }
        })
    })

$('.modal_reading_form_textarea').on("keypress", function (e) {
    /* ENTER PRESSED*/
    if (e.keyCode == 13 && !e.shiftKey) {
        var text = $('.modal_reading_form_textarea').val()
        if (text === '') {
            return false;
        }
        $.ajax({
            url: '/re/post/chat/add/rest/', type: 'post', dataType: 'json', cache: false,
            data: {
                post_chat_id: $('#reading_post_chat_last_id').html(),
                text: text,
            },
            success: function (data) {

                var delete_div;
                    if(data.set.user_id === $('#user_id').html() || data.set.user_id===$('#reading_post_user_id').html()){
                        delete_div = '<div align="right"><a href=""><span class="reading_chat_rest_messages_delete">delete</span></a></div>'
                    }
                    var pre_rest_appender = '<div class="reading_chat_rest" align="right" id="reading_chat_rest_wrapper_'+data.set.id+'">' +
                        '<div class="reading_like_wrapper">' +
                        '<a href=""><span id="rest_like_span_'+data.set.id+'"class="glyphicon glyphicon-heart-empty reading_like"></span></a>' +
                        '</div>' +
                        '<div class="reading_chat_content">' +
                        '<div class="reading_chat_rest_name">'+data.set.name+'</div>\n' +
                        '<div class="reading_chat_rest_text">'+data.set.text+'</div>\n' +
                        '</div>' +
                        '<div class="reading_chat_img">' +
                        '<img class="img_small" src="'+ data.set.photo +'">' +
                        '</div>' + delete_div +
                        '</div>'
                    var rest_appender = $(pre_rest_appender)
                    rest_appender.find('.reading_like').on('click', function (e) {
                        e.preventDefault()
                        $.ajax({
                          url: '/re/post/chat/rest/like/', type: 'post', dataType: 'json', cache: false,
                            data: {
                                rest_id: data.set.id,
                            },
                            success: function (sub_data) {
                              if (sub_data.res === 1){


                                if (sub_data.liked === true){

                                  $('#rest_like_span_'+data.set.id).removeClass('glyphicon-heart-empty')
                                  $('#rest_like_span_'+data.set.id).addClass('glyphicon-heart')
                                }   else {

                                  $('#rest_like_span_'+data.set.id).removeClass('glyphicon-heart')
                                  $('#rest_like_span_'+data.set.id).addClass('glyphicon-heart-empty')
                                }
                              }
                            }
                        })
                    })
                  rest_appender.find('.reading_chat_rest_messages_delete').on('click', function (e) {
                      e.preventDefault()
                      $.ajax({
                          url: '/re/post/chat/rest/delete/', type: 'post', dataType: 'json', cache: false,
                            data: {
                                rest_id: data.set.id,
                            },
                            success: function (sub_data) {
                              if (sub_data.res === 1){
                                  if (sub_data.deleted === true){
                                      $('#reading_chat_rest_wrapper_'+data.set.id).replaceWith('<div align="right">removed</div>')
                                  }
                              }
                            }
                        })
                  })

                $('#modal_reading_chat').append(rest_appender)

                $('.modal_reading_form_textarea').val('')
            }
        })
        return false;

    }
})
</script>


</html>
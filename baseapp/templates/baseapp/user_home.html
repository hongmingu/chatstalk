<!DOCTYPE html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Demo</title>
    {% include 'others/header_static.html' %}
    {% include 'others/favicon.html' %}

    {% load static from staticfiles %}
    <script src="{% static 'js/navbar.js' %}"></script>
    <script src="{% static 'js/a_selected.js' %}"></script>
    <script src="{% static 'js/re_socket.js' %}"></script>
    <script src="{% static 'js/nav_badge.js' %}"></script>

    <link href="https://fonts.googleapis.com/css?family=Tauri" rel="stylesheet">
    {% if user.is_authenticated %}
    {% else %}
    {% endif %}

    <style>
        .write_new_post{
            font-weight: bold; color: white; width: 100%
        }
        .home_feed_title{
            padding: 10px; font-weight: bold; font-size: 14px; white-space:pre-wrap; word-wrap: break-word; max-width: 100%;
        }
        .home_feed_desc{
            padding-right: 10px; padding-left:10px; padding-top:5px; padding-bottom:10px; font-size: 12px; white-space:pre-wrap; word-wrap: break-word; max-width: 100%;
        }
        .home_feed_chat_photo{
            font-weight: bold;
        }
        .home_feed_chat_start{

        }
        .home_feed_comment_delete {
            font-size: 12px;
        }
        .home_feed_comment_textarea {
            height: 30px!important;
            resize: none;
        }

        .home_feed_comment_textarea_send{
            height: 30px!important;
        }
        .home_feed_comment_wrapper{
            width: 100%!important;
        }
        .heart_black{
            font-size: 12px;
        }
        .home_feed_like_count{
            font-size: 12px;
        }
        .home_feed_comment_more{
            background-color: lightgray; font-size: 12px;
        }
        .home_feed_chat_new{
            background-color: hotpink; font-size: 12px;
        }
        .home_feed_new_comment{
            background-color: lightgoldenrodyellow;
        }
        .modal_close{
            position: absolute; right: 10px; top: 10px;
        }
        .modal_dialog_reading_post{
            margin-top: 8px; margin-bottom: 8px;
        }
        .modal_top_padder{
            height: 35px;
        }
        .modal_reading_chat{
            overflow-y: auto; ;
        }
        .modal_reading_form{
            position: absolute; width: 95%
        }
        .modal_reading_form_input_wrapper{
            position: absolute; top:10px
        }
        .modal_reading_form_textarea{
            height: 50px!important; resize: none;
        }
        .modal_reading_from_textarea_button{
            height: 50px!important;
        }
        .modal_reading_form_inner_wrapper{
            width: 95%;
        }

        .reading_chat_img{
            min-width: 50px; display: inline-block; vertical-align: top
        }
        .reading_chat_content{
            display:inline-block; width: 60%
        }
        .reading_chat_text{
            background-color: orange; padding: 5px
        }
        .reading_like_wrapper{
            display: inline-block; vertical-align: bottom;
        }
        .reading_like{
            font-size: 12px;
        }
        .reading_like_text{
            font-size: 10px
        }
        .reading_chat_rest_text{
            background-color: lightgray; padding: 5px; font-size: 12px
        }
        .reading_chat_more_load{
            background-color: #1b6d85; color: white
        }
        .reading_chat_started{
            background-color: #1eda0f; color: white
        }
        .reading_chat_rest_messages{
            background-color: #39d842; color: white;padding:3px; border-radius: 3px; font-size: 12px
        }
        .reading_chat_interaction_white{
            background-color: #26ff07; color:white; height: 70px; padding-top: 20px
        }
        .reading_chat_interaction_green{
            color:#26ff07; height: 70px; padding-top: 20px
        }
        .interaction_play{
            font-size: 30px;
        }
        .interaction_pre_say{
            vertical-align: top; color: white;
        }
        .reading_chat_img{
            max-width: 100%
        }

        .interaction_choice_update{
            height: 70px; float:left; display: inline-block; width: 50%; background-color: #39d842; font-size: 20px; padding:15px; color: white
        }


        .interaction_choice_interact{
            height: 70px; float:left; display: inline-block; width: 50%; font-size: 20px; padding:15px; color: #39d842
        }
    </style>


</head>
<body class="light_background_color height_100">
<!--navbar start-->
{% include 'baseapp/_navbar.html' %}

<!--navbar end-->
<!--page info-->
{% include 'others/bootstrap_tester.html' %}

<div class="hidden" id="page_kind" data-u="home"></div>
<div class="hidden" id="last_num" data-u=""></div>

<div class="hidden" id="reading_post_id"></div>
<div class="hidden" id="reading_post_profile_photo"></div>
<div class="hidden" id="reading_post_user_id"></div>
<div class="hidden" id="reading_post_profile_name"></div>
<div class="hidden" id="reading_post_chat_last_id"></div>
<div class="hidden" id="reading_post_chat_next_id"></div>

{% if user.is_authenticated %}
    <div class="hidden" id="user_id" data-u="{{ user.username }}">{{ user.username }}</div>
{% endif %}
<!--page info end -->

<div class="container-fluid margin_top_50">
    <div class="row">
        <div class="col-xs-12 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4">
            <div class="row" id="content">
                <div align="center"><a href="{% url 'baseapp:create_new' %}"><div class="clickable padding_5 main_background_color write_new_post">Write New Post</div></a></div>
                <!--여기서 modal -->

                <div class="row div_base" id="div_" data-u="1">
                    <script defer>
                        function home_populate(){
                            var id = $('script').last().parent().attr('data-u')
                            var parent_div = $('script').last().parent()
                            var user_id = $('#user_id').attr('data-u')
                            $(function () {
                                $.ajax({
                                    url: '/re/user/home/populate/', type: 'post', dataType:'json', cache: false,
                                    data: {
                                        post_id: id,
                                    },
                                    success: function (data) {

                                        if (data.res === 1){
                                            var _last_chat;
                                            switch (data.set.last_chat.kind){
                                                case 'start':
                                                    _last_chat = '<span class="home_feed_chat_start">'+'Conversation started'+'</span>'
                                                    break;
                                                case 'text':
                                                    if (data.set.you_say === true){
                                                        _last_chat = '<span>'+data.set.name+'</span><span><b>: </b></span>'+'<span class="home_feed_chat_text">'+data.set.last_chat.text+'</span>'
                                                    } else {
                                                        _last_chat = '<span class="home_feed_chat_text">'+data.set.last_chat.text+'</span>'
                                                    }
                                                    break;

                                                case 'photo':
                                                    if (data.set.you_say === true){
                                                        _last_chat = '<span>'+data.set.name+'</span><span><b>: </b></span>'+'<span class="home_feed_chat_photo">'+'photo'+'</span>'
                                                    } else {
                                                        _last_chat = '<span class="home_feed_chat_photo">'+'photo'+'</span>'
                                                    }
                                                    break;
                                                default:
                                                    _last_chat = '<span class="home_feed_chat_start">'+'Conversation?'+'</span>'
                                                    break;
                                            }
                                            var _title ,_title_class, _desc, _desc_class
                                            if (data.set.title === null){
                                                _title_class = ' hidden'
                                                _title = ''
                                            } else {
                                                _title_class = ''
                                                _title = data.set.title
                                            }
                                            if (data.set.desc === null){
                                                _desc_class = ' hidden'
                                                _desc = ''
                                            } else {
                                                _desc_class = ''
                                                _desc = data.set.desc
                                            }
                                            var _comment = '';
                                            var _last_comment_id = '';
                                            if (data.set.three_comments !== null){
                                                $.each(data.set.three_comments, function (key, value) {
                                                    var _remove;
                                                    if(value.comment_user_id===user_id){
                                                        _remove = '<a href=""><span class="glyphicon glyphicon-remove home_feed_comment_delete clickable" data-u="'+value.comment_uuid+'"></span></a>'
                                                    }
                                                    _comment = _comment + '<div id="comment_div_'+value.comment_uuid+'"><div><a href="#"><span class="comments_name">'+value.comment_username+'</span></a></div><div><span class="comments">'+value.comment_text+'</span>   <span class="home_feed_comment_time">'+date_differ(value.comment_created)+'</span> '+_remove+'</div></div>'
                                                    _last_comment_id = value.comment_uuid
                                                })
                                            }
                                            var _more_comments_class = '';
                                            if (data.set.comment_count < 4){
                                                _more_comments_class = 'hidden'
                                            }
                                            var _like = ' glyphicon-heart-empty ';
                                            if (data.set.you_liked === true){
                                                _like = ' glyphicon-heart '
                                            }
                                            var _new = '';
                                            if (data.set.new === true){
                                                _new = '<div class="home_feed_chat_new" align="center">new</div>'
                                            }
                                            // 제목에 공백만 있는 건 허용하지 말자. 자바스크립트로. 그렇게 하고 파이썬 뷰에서 그렇게 하자.
                                            var append_to = $('<div class="media">\n' +
                                                '<div class="media-heading margin_bottom_30">\n' +
                                                '<div class="col-xs-10 padding_left_0" align="left"><span\n' +
                                                'class="home_feed_name">'+data.set.username+'</span></div>\n' +
                                                '<div class="col-xs-2" align="right">\n' +
                                                '<a href="#"><span\n' +
                                                'class="glyphicon glyphicon-option-horizontal grey"></span></a></div>\n' +
                                                '</div>\n' +
                                                '<a href=""><div id="chat_div_'+data.set.id+'" class="home_feed_chat_total">'+
                                                '<div class="media-left">\n' +
                                                '<img src="'+data.set.photo+'"\n' +
                                                'class="media-object img_small">\n' +
                                                '</div>\n' +
                                                '<div class="media-body">\n' +
                                                '<div class="home_feed_chat">'+_last_chat+'</div>' + _new +
                                                '</div>\n' +
                                                '</div></a>\n' +
                                                '<div class="home_feed_title '+ _title_class +'">'+_title+'</div>\n' +
                                                '<div class="home_feed_desc '+ _desc_class +'">'+ _desc+'</div>\n' +
                                                '<div class="media-bottom"><br/>\n' +
                                                '<div class="col-xs-5" align="left"><span\n' +
                                                'class="glyphicon glyphicon-heart heart_black"></span> <span class="home_feed_like_count" id="basic_heart_'+data.set.id+'">'+data.set.like_count+'</span></div>\n' +
                                                '<div class="col-xs-5" align="right"><span class="home_feed_time">'+date_differ(data.set.created)+'</span>\n' +
                                                '</div>\n' +
                                                '<div class="col-xs-2" align="right"><a href="#"><span class="glyphicon'+_like+'heart" id="like_'+data.set.id+'"></span></a></div>\n' +
                                                '<div class=""><span class="comments_title">Comments '+data.set.comment_count+'</span></div>\n' +
                                                '<div class="comments_list" id="comment_list_'+id+'">'+_comment+'</div>\n' +
                                                '<a href="#"><div class="home_feed_comment_more clickable '+_more_comments_class+'" align="center" id="more_comments_'+data.set.id+'">more comments</div></a>\n' +
                                                '</div>\n' +
                                                '</div>\n' +
                                                '<div class="hidden" id="last_comment_'+data.set.id+'" data-u="'+_last_comment_id+'">'+_last_comment_id+'</div>'+
                                                '<div align="center">\n' +
                                                '<form class="padding_top_5">\n' +
                                                '<div class="input-group input-group-sm home_feed_comment_wrapper">\n' +
                                                '<textarea class="form-control home_feed_comment_textarea" id="textarea_'+id+'" placeholder="comment" id="comment_textarea"></textarea>\n' +
                                                '<div class="input-group-btn">\n' +
                                                '<button class="btn btn-default home_feed_comment_textarea_send" id="btn_comment_'+id+'"><i\n' +
                                                'class="glyphicon glyphicon-send"></i></button>\n' +
                                                '</div>\n' +
                                                '</div>\n' +
                                                '</form>\n' +
                                                '</div>')

                                            append_to.find('#chat_div_'+data.set.id).on('click', function (e) {
                                                e.preventDefault()
                                                $('#reading_post_id').html(data.set.id)
                                                $('#reading_post_profile_photo').html(data.set.photo)
                                                $('#reading_post_profile_name').html(data.set.name)
                                                $('#reading_post_user_id').html(data.set.user_id)
                                                $('#modal_reading_post').modal('show')
                                            })
                                            append_to.find('#like_'+data.set.id).on('click', function (e) {
                                                e.preventDefault()
                                                $.ajax({url:'/re/post/like/', type:'post', dataType:'json', cache:false,
                                                    data:{
                                                        post_id:data.set.id,
                                                    },
                                                    success:function (sub_data) {
                                                    console.log(sub_data)
                                                        if (sub_data.res === 1) {
                                                            var current_count = parseInt($('#basic_heart_'+data.set.id).html())
                                                            if (sub_data.liked === true){
                                                                if ($('#like_'+data.set.id).hasClass('glyphicon-heart-empty')){
                                                                    $('#like_'+data.set.id).removeClass('glyphicon-heart-empty')
                                                                    $('#like_'+data.set.id).addClass('glyphicon-heart')
                                                                }
                                                                $('#basic_heart_'+data.set.id).html(current_count + 1)
                                                            } else if (sub_data.liked === false){
                                                                if ($('#like_'+data.set.id).hasClass('glyphicon-heart')){
                                                                    $('#like_'+data.set.id).removeClass('glyphicon-heart')
                                                                    $('#like_'+data.set.id).addClass('glyphicon-heart-empty')
                                                                }
                                                                $('#basic_heart_'+data.set.id).html(current_count - 1)
                                                            }


                                                        }
                                                    }
                                                })
                                            })
                                            //이제 대화 모달이랑 그다음 포스트메뉴 모달 만들고 프로필창 만들고 .
                                            append_to.find('.home_feed_comment_delete').on('click', function (e) {
                                                e.preventDefault()
                                                var deleted_id = $(this).attr('data-u')
                                                $.ajax({url:'/re/comment/delete/', type:'post', dataType:'json', cache:false,
                                                    data:{
                                                        post_id:id,
                                                        comment_id:deleted_id,
                                                    },
                                                    success:function (sub_data) {
                                                    console.log(sub_data)
                                                        if (sub_data.res === 1) {
                                                            $('#comment_div_'+deleted_id).replaceWith('<div>removed</div>')
                                                        }
                                                    }
                                                })
                                            })
                                            append_to.find('#textarea_'+id).on('keypress', function (e) {
                                                if (e.keyCode == 13 && !e.shiftKey) {
                                                    var text = $('#textarea_'+id).val()
                                                    if (text === '') {
                                                        return false;
                                                    } else if (1<=text.length && text.length<=1000) {
                                                        $.ajax({url:'/re/comment/add/', type:'post', dataType:'json', cache:false,
                                                            data:{
                                                                post_id:id,
                                                                comment:text,
                                                            },
                                                            success:function (data) {
                                                            console.log(data)
                                                                if (data.res === 1) {
                                                                    var _comment = '';
                                                                    if (data.set !== null){
                                                                        $.each(data.set, function (key, value) {
                                                                            var _remove;
                                                                            if(value.comment_user_id===user_id){
                                                                                _remove = '<a href=""><span class="glyphicon glyphicon-remove home_feed_comment_delete clickable" data-u="'+value.comment_uuid+'"></span></a>'
                                                                            }
                                                                            _comment = '<div class="home_feed_new_comment" id="comment_div_'+value.comment_uuid+'"><div><a href="#"><span class="comments_name">'+value.comment_username+'</span></a></div><div><span class="comments">'+value.comment_text+'</span>   <span class="home_feed_comment_time">'+date_differ(value.comment_created)+'</span> '+_remove+'</div></div>'
                                                                        })
                                                                    }
                                                                    var _comment_prepender = $(_comment)
                                                                    _comment_prepender.find('.home_feed_comment_delete').on('click', function (e) {
                                                                        e.preventDefault()
                                                                        var deleted_id = $(this).attr('data-u')
                                                                        $.ajax({url:'/re/comment/delete/', type:'post', dataType:'json', cache:false,
                                                                            data:{
                                                                                post_id:id,
                                                                                comment_id:deleted_id,
                                                                            },
                                                                            success:function (data) {
                                                                            console.log(data)
                                                                                if (data.res === 1) {
                                                                                    $('#comment_div_'+deleted_id).replaceWith('<div>removed</div>')
                                                                                }
                                                                            }
                                                                        })
                                                                    })
                                                                    $('#comment_list_'+id).prepend(_comment_prepender)
                                                                    $('#textarea_'+id).val('')
                                                                }
                                                            }
                                                        })
                                                    }
                                                    else if ( 1000< text.length){
                                                        alert('too long')
                                                    }
                                                }
                                            })

                                            append_to.find('#btn_comment_'+id).on('click', function (e) {
                                                e.preventDefault()
                                                var text = $('#textarea_'+id).val()
                                                if (text === '') {
                                                    return false;
                                                }
                                                else if (1<=text.length && text.length<=1000) {
                                                    $.ajax({url:'/re/comment/add/', type:'post', dataType:'json', cache:false,
                                                        data:{
                                                            post_id:id,
                                                            comment:text,
                                                        },
                                                        success:function (data) {
                                                        console.log(data)
                                                            if (data.res === 1) {
                                                                var _comment = '';
                                                                if (data.set !== null){
                                                                    $.each(data.set, function (key, value) {
                                                                        var _remove;
                                                                        if(value.comment_user_id===user_id){
                                                                            _remove = '<a href=""><span class="glyphicon glyphicon-remove home_feed_comment_delete clickable" data-u="'+value.comment_uuid+'"></span></a>'
                                                                        }
                                                                        _comment = '<div class="home_feed_new_comment" id="comment_div_'+value.comment_uuid+'"><div><a href="#"><span class="comments_name">'+value.comment_username+'</span></a></div><div><span class="comments">'+value.comment_text+'</span>   <span class="home_feed_comment_time">'+date_differ(value.comment_created)+'</span> '+_remove+'</div></div>'
                                                                    })
                                                                }
                                                                var _comment_prepender = $(_comment)
                                                                _comment_prepender.find('.home_feed_comment_delete').on('click', function (e) {
                                                                    e.preventDefault()
                                                                    var deleted_id = $(this).attr('data-u')
                                                                    $.ajax({url:'/re/comment/delete/', type:'post', dataType:'json', cache:false,
                                                                        data:{
                                                                            post_id:id,
                                                                            comment_id:deleted_id,
                                                                        },
                                                                        success:function (data) {
                                                                        console.log(data)
                                                                            if (data.res === 1) {
                                                                                $('#comment_div_'+deleted_id).replaceWith('<div>removed</div>')
                                                                            }
                                                                        }
                                                                    })
                                                                })
                                                                $('#comment_list_'+id).prepend(_comment_prepender)
                                                                $('#textarea_'+id).val('')
                                                            }
                                                        }
                                                    })
                                                }
                                                else if ( 1000< text.length){
                                                    alert('too long')
                                                }

                                            })

                                            append_to.find('#more_comments_'+data.set.id).on('click', function (e) {
                                                e.preventDefault()
                                                $.ajax({url:'/re/comment/more/load/', type:'post', dataType:'json', cache:false,
                                                    data:{
                                                        post_id:id,
                                                        last_comment_id:$('#last_comment_'+data.set.id).html(),
                                                    },
                                                    success:function (sub_data) {
                                                    console.log(sub_data)
                                                        if (sub_data.res === 1) {
                                                            var _comment = '';
                                                            if (sub_data.set !== null){
                                                                $.each(sub_data.set, function (key, value) {

                                                                    var _remove;
                                                                    if(value.comment_user_id===user_id){
                                                                        _remove = '<a href=""><span class="glyphicon glyphicon-remove home_feed_comment_delete clickable" data-u="'+value.comment_uuid+'"></span></a>'
                                                                    }
                                                                    _comment = _comment + '<div id="comment_div_'+value.comment_uuid+'"><div><a href="#"><span class="comments_name">'+value.comment_username+'</span></a></div><div><span class="comments">'+value.comment_text+'</span>   <span class="home_feed_comment_time">'+date_differ(value.comment_created)+'</span> '+_remove+'</div></div>'
                                                                    $('#last_comment_'+data.set.id).html(value.comment_uuid)
                                                                    //이제 end 일 경우 hidden 붙이는거랑 삭제 구현하자.
                                                                })
                                                            }
                                                            var _comment_appender = $(_comment)
                                                            _comment_appender.find('.home_feed_comment_delete').on('click', function (e) {
                                                                e.preventDefault()
                                                                var deleted_id = $(this).attr('data-u')
                                                                $.ajax({url:'/re/comment/delete/', type:'post', dataType:'json', cache:false,
                                                                    data:{
                                                                        post_id:id,
                                                                        comment_id:deleted_id,
                                                                    },
                                                                    success:function (data) {
                                                                    console.log(data)
                                                                        if (data.res === 1) {
                                                                            $('#comment_div_'+deleted_id).replaceWith('<div>removed</div>')
                                                                        }
                                                                    }
                                                                })
                                                            })
                                                            $('#comment_list_'+id).append(_comment_appender)
                                                            if (sub_data.end === true){
                                                                if (!($('#more_comments_'+data.set.id).hasClass('hidden'))){
                                                                    $('#more_comments_'+data.set.id).addClass('hidden')
                                                                }
                                                            }

                                                        }
                                                    }
                                                })
                                            })

                                            $('#div_').append(append_to)
                                            console.log('saved')
                                        }
                                    }
                                })
                            })
                        }
                        home_populate()
                    </script>
                </div>


<!--대화창을 지울 생각을 한 건 행운이 따른 것이다.-->

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_menu">
    <div class="modal-dialog modal-dialog_menu">
      <div class="modal-content modal-content_menu">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body modal-body_menu">
            <div class="row">
              <p class="h4" align="center"><a href="{% url 'authapp:settings' %}"><span class="clickable padding_5" style="background-color: #00aced">Settings</span></a></p>
            </div>
            <div class="row">
              <p class="h4" align="center"><a href="{% url 'authapp:log_out' %}"><span class="clickable padding_5" style="background-color: #00aced">Log out</span></a></p>
            </div>
        </div>
        <div class="modal-footer modal-footer_menu">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
</div>
  <!-- Hidden 으로 데이터 저장해놓고 modal on show 랑 hide 에서 그 데이터 불러와서 모달 채우게 하자. 그리고 임플린은 친구 중심이고
  피드가 존재하게 되었기 때문에 팔로우가 부가적으로 존재하는 것 뿐이다. -->
  <div class="modal fade" id="modal_reading_post">
    <div class="modal-dialog modal_dialog_reading_post">
      <div class="modal-content" id="modal_reading_post_content">

        <div class="modal-body padding_0">

            <button type="button" class="close modal_close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <div class="modal_top_padder"></div>
            <div id="modal_reading_contents">
                <div class="modal_reading_chat" id="modal_reading_chat">
                    <a href=""><div class="reading_chat_more_load clickable" id="reading_chat_more_load" align="center">MORE LOAD</div></a>
                    <div class="reading_chat_started" align="center">Convo started</div>
                    <div class="reading_chat_left" align="left">
                        <div class="reading_chat_img">
                            <img class="img_small" src="http://static.news.zumst.com/images/111/2018/01/10/39832329eef6467b94ee5b390ffd348f.jpg">
                        </div>
                        <div class="reading_chat_content">
                            <div class="reading_chat_name">욜로욜로욜로요~</div>
                            <div class="reading_chat_text">욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요~</div>
                        </div>
                        <div class="reading_like_wrapper">
                            <span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">102000k</span>
                        </div>
                    </div>

                    <div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">10</span></div>

                    <div class="reading_chat_right" align="right">
                        <div class="reading_like_wrapper">
                            <span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">102000k</span>
                        </div>
                        <div class="reading_chat_content">
                            <div class="reading_chat_name">욜로욜로욜로요~</div>
                            <div class="reading_chat_text">욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요~</div>

                        </div>

                        <div class="reading_chat_img">
                            <img class="img_small" src="http://static.news.zumst.com/images/111/2018/01/10/39832329eef6467b94ee5b390ffd348f.jpg">
                        </div>
                    </div>

                    <div class="reading_chat_right" align="right">
                        <div class="reading_like_wrapper">
                            <span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">102000k</span>
                        </div>
                        <div class="reading_chat_content">
                            <div class="reading_chat_name">욜로욜로욜로요~</div>
                            <div><img class="reading_chat_img" src="https://lh5.googleusercontent.com/-AW0OXT3lU_0/VGFIvdFewbI/AAAAAAAAkiU/s0wd-K57WDY/s288/20141110-947.jpg"></div>
                        </div>
                        <div class="reading_chat_img">
                            <img class="img_small" src="http://static.news.zumst.com/images/111/2018/01/10/39832329eef6467b94ee5b390ffd348f.jpg">
                        </div>
                    </div>
                    <div class="reading_chat_rest" align="left" style="background-color: lightgreen;">
                        <div class="reading_chat_img">
                            <img class="img_small" src="http://static.news.zumst.com/images/111/2018/01/10/39832329eef6467b94ee5b390ffd348f.jpg">
                        </div>
                        <div class="reading_chat_content">
                            <div class="reading_chat_rest_name">욜로욜로욜로요~</div>
                            <div class="reading_chat_rest_text">욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요욜로욜로욜로요~</div>

                        </div>
                        <div class="reading_like_wrapper">
                            <span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">102000k</span>
                        </div>
                    </div>

                </div>
                <div class="modal_reading_interaction" id="modal_reading_interaction" align="center">
                    <a href="">
                        <div class="clickable reading_chat_interaction_white hidden reading_chat_next reading_chat_play" id="interaction_play_white">
                            <span class="glyphicon glyphicon-play interaction_play"></span>
                        </div>
                    </a>

                    <a href="">
                        <div class="clickable reading_chat_interaction_green reading_chat_next reading_chat_play" id="interaction_play_green">
                            <span class="glyphicon glyphicon-play interaction_play"></span>
                        </div>
                    </a>

                    <a href="">
                        <div class="reading_chat_interaction_update reading_chat_next hidden" id="interaction_update">
                            <a href=""><div class="clickable interaction_choice_update" style="">update</div></a>
                            <a href=""><div class="clickable interaction_choice_interact" style="height: 70px; float:left; display: inline-block; width: 50%; font-size: 20px; padding:15px; color: #39d842">interact</div></a>
                        </div>
                    </a>
                    <div class="modal_reading_form_inner_wrapper reading_chat_next hidden" id="interaction_form">
                        <form class="modal_reading_form">
                        <div class="input-group input-group-sm modal_reading_form_input_wrapper">
                            <textarea class="form-control modal_reading_form_textarea" placeholder="message"></textarea>
                            <div class="input-group-btn">
                                <button class="btn btn-default modal_reading_from_textarea_button" type="submit"><i
                                        class="glyphicon glyphicon-send"></i></button>
                            </div>
                        </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
      </div>
    </div>
  </div>

</body>


<script>
    $(function () {
        var height = $(window).height();
        $('#modal_reading_post_content').css('height', height-16);
        $('#modal_reading_chat').css('height', height-16-70-35)
        $(window).on('resize', function(){

            if($(window).height() != height){
                height = $(window).height();

                $('#modal_reading_post_content').css('height', height-16);
                $('#modal_reading_chat').css('height', height-16-70-35)
            }
        });
    })

</script>
<script>


    $("#modal_reading_post").on("shown.bs.modal", function () {

        var height = $(window).height();
        $('#modal_reading_post_content').css('height', height-16);
        $('#modal_reading_chat').css('height', height-16-70-35)

        var reading_post_id = $('#reading_post_id').html()
        var reading_post_profile_photo = $('#reading_post_profile_photo').html()
        var reading_post_profile_name = $('#reading_post_profile_name').html()
        $.ajax({url:'/re/post/already/read/', type:'post', dataType:'json', cache:false,
            data:{
                post_id:reading_post_id,
            },
            success:function (data) {
            console.log(data)
                if (data.res === 1) {
                var start = false
                    $.each(data.set, function (key, value) {
                        var prepender;

                        var align, profile_photo, chat_content, like, like_count, rest_messages;

                        $('#reading_post_chat_last_id').html(value.id)
                        switch (value.kind) {
                            case 'start':
                                start = true
                                prepender = $('<div class="reading_chat_started" align="center">Convo started</div>')
                                break;
                            case 'text':
                                if (value.you_say === true){
                                    align = 'left';
                                    like_count = value.like_count
                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)

                                        like_count = like_count + 'k'
                                    }
                                    profile_photo = '<div class="reading_chat_img">\n' +
                                        '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                        '<div class="reading_chat_text">'+value.content+'</div>' +
                                        '</div>'
                                    like = '<div class="reading_like_wrapper">' +
                                        '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                        '</div>' +
                                        '</div>'

                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                                '</div>\n')

                                } else if(value.you_say === false){
                                    align = 'right';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_text">'+value.content+'</div>' +
                                        '</div>'
                                    like = '<div class="reading_like_wrapper">' +
                                        '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                        '</div>' +
                                        '</div>'

                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                                '</div>\n')

                                }

                                break;

                            case 'photo':

                                if (value.you_say === true){

                                    align = 'left';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    profile_photo = '<div class="reading_chat_img">\n' +
                                        '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                        '<div><img class="reading_chat_img" src="'+value.content+'"></div>'+
                                        '</div>'
                                    like = '<div class="reading_like_wrapper">' +
                                        '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                        '</div>' +
                                        '</div>'

                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                                '</div>\n')
                                } else if(value.you_say === false) {

                                    align = 'right';
                                    like_count = value.like_count

                                    if (1000 <= value.like_count){
                                        like_count = parseInt(value.like_count / 1000)
                                        like_count = like_count + 'k'
                                    }
                                    chat_content = '<div class="reading_chat_content">' +
                                        '<div><img class="reading_chat_img" src="'+value.content+'"></div>' +
                                        '</div>'
                                    like = '<div class="reading_like_wrapper">' +
                                        '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                        '</div>' +
                                        '</div>'

                                    if(value.rest_count=== 0){
                                        rest_messages = ''
                                    } else if (value.rest_count < 1000){
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                                    } else if (1000 <= value.rest_count) {
                                        rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                                    }

                                    prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                                '</div>\n')

                                }

                                break;
                            default:
                                break;
                        }
                        $('#modal_reading_chat').prepend(prepender)

                    })
                    console.log(data)


                    if (data.next === null){
                        if ($('#reading_post_user_id').html()===$('#user_id').html()){
                            //same author
                        } else if ($('#reading_post_user_id').html()==!$('#user_id').html()){

                        }
                    } else {

                        $('#reading_post_chat_next_id').html(data.next.content.id)
                        if (data.next.content.you_say === true){
                            $('.reading_chat_next').addClass('hidden')
                            $('#interaction_play_white').removeClass('hidden')
                        } else if (data.next.content.you_say === false){
                            $('.reading_chat_next').addClass('hidden')
                            $('#interaction_play_green').removeClass('hidden')
                        }

                    }
                    if (start === false){
                        if ($('#reading_chat_more_load').hasClass('hidden')){
                            $('#reading_chat_more_load').addClass('hidden')
                        }
                    }

                }
            }
        })

    }).on("hidden.bs.modal", function () {
        $('#modal_reading_chat').empty()
    });
    $('#reading_chat_more_load').click(function (e) {
        e.preventDefault()
        $.ajax({url:'/re/post/reading/more/load/', type:'post', dataType:'json', cache:false,
            data:{
                post_id:$('#reading_post_chat_last_id').html(),
            },
            success:function (data) {


            }
        })
    })

    $('.reading_chat_play').click(function (e) {
        e.preventDefault()


        var reading_post_id = $('#reading_post_id').html()
        var reading_post_profile_photo = $('#reading_post_profile_photo').html()
        var reading_post_profile_name = $('#reading_post_profile_name').html()
        $.ajax({url:'/re/post/chat/next/load/', type:'post', dataType:'json', cache:false,
            data:{
                post_chat_next_id:$('#reading_post_chat_next_id').html(),
            },
            success:function (data) {
            var prepender, align, profile_photo, chat_content, like, like_count, rest_messages;
            var start = false
            var last_id;
            console.log(data)
            $.each(data.set, function (key, value) {
                switch (value.kind) {
                    case 'start':
                        start = true
                        prepender = $('<div class="reading_chat_started" align="center">Convo started</div>')
                        break;
                    case 'text':
                        if (value.you_say === true){
                            align = 'left';
                            like_count = value.like_count
                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)

                                like_count = like_count + 'k'
                            }
                            profile_photo = '<div class="reading_chat_img">\n' +
                                '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                            chat_content = '<div class="reading_chat_content">' +
                                '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                '<div class="reading_chat_text">'+value.content+'</div>' +
                                '</div>'
                            like = '<div class="reading_like_wrapper">' +
                                '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                '</div>' +
                                '</div>'

                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                            }

                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                        '</div>\n')

                        } else if(value.you_say === false){
                            align = 'right';
                            like_count = value.like_count

                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)
                                like_count = like_count + 'k'
                            }
                            chat_content = '<div class="reading_chat_content">' +
                                '<div class="reading_chat_text">'+value.content+'</div>' +
                                '</div>'
                            like = '<div class="reading_like_wrapper">' +
                                '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                '</div>' +
                                '</div>'

                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                            }

                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                        '</div>\n')

                        }

                        break;

                    case 'photo':

                        if (value.you_say === true){

                            align = 'left';
                            like_count = value.like_count

                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)
                                like_count = like_count + 'k'
                            }
                            profile_photo = '<div class="reading_chat_img">\n' +
                                '<img class="img_small" src="'+ reading_post_profile_photo +'"></div>\n';
                            chat_content = '<div class="reading_chat_content">' +
                                '<div class="reading_chat_name">'+reading_post_profile_name+'</div>' +
                                '<div><img class="reading_chat_img" src="'+value.content+'"></div>'+
                                '</div>'
                            like = '<div class="reading_like_wrapper">' +
                                '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                '</div>' +
                                '</div>'

                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                            }

                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + profile_photo + chat_content + like + rest_messages +
                                        '</div>\n')
                        } else if(value.you_say === false) {

                            align = 'right';
                            like_count = value.like_count

                            if (1000 <= value.like_count){
                                like_count = parseInt(value.like_count / 1000)
                                like_count = like_count + 'k'
                            }
                            chat_content = '<div class="reading_chat_content">' +
                                '<div><img class="reading_chat_img" src="'+value.content+'"></div>' +
                                '</div>'
                            like = '<div class="reading_like_wrapper">' +
                                '<span class="glyphicon glyphicon-heart reading_like"></span><span class="reading_like_text" style=""> </span><span class="reading_like_text">'+like_count+'</span>' +
                                '</div>' +
                                '</div>'

                            if(value.rest_count=== 0){
                                rest_messages = ''
                            } else if (value.rest_count < 1000){
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+value.rest_count+'</span></div>'
                            } else if (1000 <= value.rest_count) {
                                rest_messages = '<div><span class="glyphicon glyphicon-comment reading_chat_rest_messages">'+parseInt(value.like_count / 1000)+'k'+'</span></div>'
                            }

                            prepender = $('<div class="reading_chat_left" align="' + align + '">' + like + chat_content + rest_messages +
                                        '</div>\n')

                        }

                        break;
                    default:
                        break;
                }

                $('#modal_reading_chat').append(prepender)

            })

            if (data.next === null){
                    if ($('#reading_post_user_id').html()===$('#user_id').html()){
                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_update').removeClass('hidden')
                    } else if ($('#reading_post_user_id').html()==!$('#user_id').html()){
                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_form').removeClass('hidden')
                    }
                } else {

                    $('#reading_post_chat_next_id').html(data.next.content.id)
                    if (data.next.content.you_say === true){
                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_play_white').removeClass('hidden')
                    } else if (data.next.content.you_say === false){
                        $('.reading_chat_next').addClass('hidden')
                        $('#interaction_play_green').removeClass('hidden')
                    }

                }



            }
        })
    })
</script>
<script>

    var date_differ = function date_differ(datetime){
        var minute_unit = 1000 * 60; // hour
        var hour_unit = 1000 * 60 * 60; // hour
        var day_unit = 1000 * 60 * 60 * 24;// day
        var month_unit = 1000 * 60 * 60 * 24 * 30;// month
        var year_unit = 1000 * 60 * 60 * 24 * 30 * 12; // year
        var current_time = new Date();
        var target_time = new Date(datetime);
        var difference = current_time - target_time
        if (difference < minute_unit){
            return 'just now'
        } else if (minute_unit <= difference && difference < 2 * minute_unit){
            return 'a minute ago'
        } else if (2 * minute_unit <= difference && difference < hour_unit) {
            return parseInt(difference/minute_unit) + ' minutes ago'
        } else if (hour_unit <= difference && difference < 2 * hour_unit) {
            return 'a hour ago'
        } else if (2 * hour_unit <= difference && difference < day_unit) {
            return parseInt(difference/hour_unit) + ' hours ago'
        } else if (day_unit <= difference && difference < 2 * day_unit) {
            return 'a day ago'
        } else if (2 * day_unit <= difference && difference < month_unit) {
            return parseInt(difference/day_unit) + ' days ago'
        } else if (month_unit <= difference && difference < 2 * month_unit) {
            return 'a month ago'
        } else if (2 * month_unit <= difference && difference < year_unit) {
            return parseInt(difference/month_unit) + ' months ago'
        } else if (year_unit <= difference && difference < 2 * year_unit) {
            return 'a year ago'
        } else if (2 * year_unit <= difference) {
            return parseInt(difference/year_unit) + ' years ago'
        }
    }
    function base_request() {
        var last_num = $('#last_num').attr('data-u')
        var kind = $('#page_kind').attr('data-u')

        $(function () {
            if (kind === 'home'){
                $.ajax({url:'/re/task/', type:'post', dataType:'json', cache:false,
                    data:{
                        command:'home',
                        last_num:last_num
                    },
                    success:function (data) {
                        if (data.res === 1) {
                            var append = ''
                            $('#content').append(append);
                        }
                    }
                });
            }
        })
    }
    base_request()


</script>


</html>